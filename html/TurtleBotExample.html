<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FlexXlam SDK: Turtle-Bot Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
  DoxygenAwesomeInteractiveToc.init()
  DoxygenAwesomeParagraphLink.init()
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="page_container">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%;">
 <tbody>
 <tr>
  <td style="padding-left: 0.5em; text-align: right;">
   <span id="projectnumber">Version: 0.0.2</span>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Turtle-Bot Example</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md16">1. Setup the environment</a><ul><li class="level2"><a href="#autotoc_md17">1.1. Hardware setup</a><ul><li class="level3"><a href="#autotoc_md18">1.1.1. Setup raspberry pi for TurtleBot</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md19">1.2. Driver setup</a><ul><li class="level3"><a href="#autotoc_md20">1.2.1. Build the Driver on TurtleBot Raspberry Pi</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md22">2. Run client</a></li>
<li class="level1"><a href="#autotoc_md23">3. Configure FlexXlam Configurations</a></li>
<li class="level1"><a href="#autotoc_md25">4. Hardware connection</a><ul><li class="level2"><a href="#autotoc_md26">4.1. Serial Connection</a></li>
<li class="level2"><a href="#autotoc_md27">4.2. Eternet Connection</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md29">5. Custom usage for FlexXlam data</a><ul><li class="level2"><a href="#autotoc_md30">5.1. Subscriber example for FlexXlam data</a></li>
<li class="level2"><a href="#autotoc_md31">5.2. Save PCD data</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md16"></a>
1. Setup the environment</h1>
<ul>
<li>Setup environment for communication with FlexXlam and turtlebot</li>
</ul>
<h2><a class="anchor" id="autotoc_md17"></a>
1.1. Hardware setup</h2>
<h3><a class="anchor" id="autotoc_md18"></a>
1.1.1. Setup raspberry pi for TurtleBot</h3>
<ul>
<li>Build Driver with local ROS, please use ROS version noetic (<a href="https://wiki.ros.org/noetic/Installation/Ubuntu">Installation</a>)</li>
<li><b>NOTE</b>: We prefer you to use docker because the Debian OS version which supports ROS noetic is out of date</li>
</ul>
<details >
<summary >
How to install docker in RPi Debian OS</summary>
<p></p>
<ul>
<li><a href="https://docs.docker.com/engine/install/debian/">Official Docker installation website</a></li>
</ul>
<ol type="1">
<li>Uninstall the installed old version docker <div class="fragment"><div class="line"># Uninstall the installed old version Docker</div>
<div class="line">for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get remove $pkg; done</div>
</div><!-- fragment --></li>
<li>Set up docker's apt repository <div class="fragment"><div class="line"># Add Docker&#39;s official GPG key:</div>
<div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install ca-certificates curl gnupg</div>
<div class="line">sudo install -m 0755 -d /etc/apt/keyrings</div>
<div class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</div>
<div class="line">sudo chmod a+r /etc/apt/keyrings/docker.gpg</div>
<div class="line"> </div>
<div class="line"># Add the repository to Apt sources:</div>
<div class="line">echo \</div>
<div class="line">  &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \</div>
<div class="line">  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \</div>
<div class="line">  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</div>
<div class="line">sudo apt-get update</div>
</div><!-- fragment --></li>
<li>Install the Docker packages <div class="fragment"><div class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</div>
</div><!-- fragment --></li>
<li>Verity that the installation is successful by running the <code>hello-world</code> image <div class="fragment"><div class="line">sudo docker run hello-world</div>
</div><!-- fragment --></li>
<li>Give permission to user to use docker w/o sudo <div class="fragment"><div class="line"># Create the docker group</div>
<div class="line">sudo groupadd docker</div>
<div class="line"> </div>
<div class="line"># Add your user to the docker group</div>
<div class="line">sudo usermod -aG docker $USER</div>
<div class="line"> </div>
<div class="line"># Log out and log back in so that your group membership is re-evaluated.</div>
<div class="line">newgrp docker</div>
<div class="line"> </div>
<div class="line"># Check the authority</div>
<div class="line">docker run hello-world</div>
</div><!-- fragment --></li>
<li>(Optional) Install ducker to use docker easier <div class="fragment"><div class="line">curl https://raw.githubusercontent.com/JeiKeiLim/ducker/main/install.sh | bash -s install linux arm64</div>
</div><!-- fragment --> </li>
</ol>
</details>
<h2><a class="anchor" id="autotoc_md19"></a>
1.2. Driver setup</h2>
<h3><a class="anchor" id="autotoc_md20"></a>
1.2.1. Build the Driver on TurtleBot Raspberry Pi</h3>
<ul>
<li>Should build the driver on TurtleBot raspberry pi for get data from FlexXlam with ROS message</li>
<li>Please check the <a href="https://github.com/j-marple-dev/FlexXlam_driver/blob/main/README.md">README</a> for building FlexXlam driver</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md22"></a>
2. Run client</h1>
<ul>
<li>The FlexXlam driver for server will be launched automatically.</li>
<li>To check the result of FlexXlam, use <b>Remote server</b> of turtlebot to run rviz</li>
<li><b>NOTE</b>: The RPi of turtlebot and the remote server must be connected with same network</li>
<li><b>NOTE</b>: The command below should be type inside the docker container <div class="fragment"><div class="line"># 1. Set the ROS master ip of Remote server</div>
<div class="line">$ export ROS_MASTER_URI=http://{remote_server_ip}:11311</div>
<div class="line">$ export ROS_HOSTNAME={remote_server_ip}</div>
<div class="line"> </div>
<div class="line"># 2. Turn on the roscore</div>
<div class="line">$ roscore</div>
<div class="line"> </div>
<div class="line"># 3. launch ros core and rviz</div>
<div class="line">$ rviz -d {FlexXlam_driver_dir}/docs/examples/turtlebot/config/rviz.rviz</div>
</div><!-- fragment --></li>
<li>Set the remote server ip to turtlebot Raspberry Pi</li>
<li>If the remote server ip is <code>192.168.0.3</code> the <code>ROS_MASTER_URI</code> will be <code><a href="http://192.168.0.3:11311">http://192.168.0.3:11311</a></code> <div class="fragment"><div class="line"># if using docker, the command below run inside the docker</div>
<div class="line"># 1. Setup the master ip of ROS and the host name</div>
<div class="line">$ export ROS_MASTER_URI=http://{remote_server_ip}:11311</div>
<div class="line">$ export ROS_HOSTNAME={turtlebot_rpi_ip}</div>
<div class="line"> </div>
<div class="line">$ source devel/setup.bash</div>
<div class="line">$ roslaunch flexxlam_driver flexxlam_driver_client.launch</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md23"></a>
3. Configure FlexXlam Configurations</h1>
<ul>
<li>Check the <a href="https://github.com/j-marple-dev/FlexXlam_driver/blob/main/README.md#122-server-configuration">Server Configuration</a></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md25"></a>
4. Hardware connection</h1>
<h2><a class="anchor" id="autotoc_md26"></a>
4.1. Serial Connection</h2>
<ul>
<li>To make the serial communication module, connect the pins of module like below</li>
</ul>
<div class="image">
<img src="uart_rxtx_twist.jpg" alt="" width="30%"/>
<div class="caption">
Image from https://www.vectornav.com</div></div>
    <ul>
<li>Connect FlexXlam with <em>TurtleBot RPi</em>, use serial module and connect like below</li>
</ul>
<div class="image">
<img src="turtlebot3-rpi-connection.jpg" alt="" width="50%"/>
<div class="caption">
Serial with flexlam and turtlebot3 rpi</div></div>
    <h2><a class="anchor" id="autotoc_md27"></a>
4.2. Eternet Connection</h2>
<p><b>TODO(ulken94)</b>: Fill this part</p><ul>
<li>Connect the <em>TurtleBot RPi</em> with FlexXlam module with ethernet, make</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md29"></a>
5. Custom usage for FlexXlam data</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
5.1. Subscriber example for FlexXlam data</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ros.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;nav_msgs/Odometry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sensor_msgs/PointCloud2.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// There are two major data from FlexXlam sensor</span></div>
<div class="line"><span class="keywordtype">void</span> odometry_callback(<span class="keyword">const</span> nav_msgs::Odometry::ConstPtr &amp;msg) {</div>
<div class="line">  <span class="comment">// Do something with odometry msg</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;pos x: &quot;</span> &lt;&lt; msg.pose.pose.position.x &lt;&lt;</div>
<div class="line">               <span class="stringliteral">&quot; pos y: &quot;</span> &lt;&lt; msg.pose.pose.position.y &lt;&lt;</div>
<div class="line">               <span class="stringliteral">&quot; pos z: &quot;</span> &lt;&lt; msg.pose.pose.position.z &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> pointcloud_callback(<span class="keyword">const</span> sensor_msgs::PointCloud2::ConstPtr &amp;msg) {</div>
<div class="line">  <span class="comment">// Do somting with pointcloud msg here</span></div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line">  ros::init(argc, argv, <span class="stringliteral">&quot;exampleSubscriber&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  ros::NodeHandle nh;</div>
<div class="line">  odom_sub = nh.subscribe&lt;nav_msgs::Odometry&gt;(<span class="stringliteral">&quot;/FlexXlam/odom&quot;</span>, 200000, odometry_callback);</div>
<div class="line">  pointcloud_sub = nh.subscribe&lt;sensor_msgs::PointCloud2&gt;(<span class="stringliteral">&quot;/FlexXlam/pointcloud&quot;</span>, 200000, pointcloud_callback);</div>
<div class="line"> </div>
<div class="line">  ros::spin();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
5.2. Save PCD data</h2>
<div class="fragment"><div class="line"># CMD,SAVE_PCD,save_pcd_flag,reset_flag</div>
<div class="line">$ rostopic pub /FlexXlam/request std_msgs/String CMD,SAVE_PCD,1,0</div>
</div><!-- fragment --><ul>
<li>You can send the msg to FlexXlam with code if you need</li>
</ul>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->

<address class="footer">
	<small>
		Generated by <a href="http://www.doxygen.org/index.html" target="_new">Doxygen</a> 1.9.8
	</small>
</address>
<!--EXTRA FOOTER SCRIPT-->
</div><!-- #page_container -->
</body>
</html>
